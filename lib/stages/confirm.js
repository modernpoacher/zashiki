"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});var _exportNames={get:true,post:true,pre:true,state:true,change:true};exports.get=get;exports.post=post;Object.defineProperty(exports,"change",{enumerable:true,get:function(){return _stages.change;}});exports.state=exports.pre=void 0;var _debug=_interopRequireDefault(require("debug"));var _config=require("@modernpoacher/zashiki-transport/lib/config");var _confirm=require("@modernpoacher/zashiki-transport/lib/confirm");Object.keys(_confirm).forEach(function(key){if(key==="default"||key==="__esModule")return;if(Object.prototype.hasOwnProperty.call(_exportNames,key))return;Object.defineProperty(exports,key,{enumerable:true,get:function(){return _confirm[key];}});});var _stages=require("@modernpoacher/zashiki-transport/lib/stages");var _jid=_interopRequireDefault(require("../common/pre/jid"));var _rid=_interopRequireDefault(require("../common/pre/rid"));var _exception=require("../common/exception");const log=(0,_debug.default)('zashiki:stages:confirm');log('`confirm` is awake');async function get({pre:{jid,rid}}){try{log({jid,rid});await(0,_stages.change)({jid,rid,resource:_config.CONFIRM_RESOURCE});return(0,_confirm.fetch)({jid,rid});}catch(e){(0,_exception.handleException)(e);}}async function post({pre:{jid,rid,response}}){try{log({jid,rid});await(0,_stages.change)({jid,rid,resource:_config.CONFIRM_RESOURCE});await(0,_confirm.store)({jid,rid,response});}catch(e){(0,_exception.handleException)(e);}}const pre=[_jid.default,_rid.default];exports.pre=pre;const state={parse:true,failAction:'error'};exports.state=state;