"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=getRID;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));require("regenerator-runtime/runtime");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _debug=_interopRequireDefault(require("debug"));var _boom=_interopRequireDefault(require("@hapi/boom"));var _master=require("@modernpoacher/zashiki-transport/lib/stores/components/route-list/master");var _maps=require("@modernpoacher/zashiki-transport/lib/maps");var _caches=require("@modernpoacher/zashiki-transport/lib/caches");var _exception=require("../../exception");var routeListMaster=new _master.RouteListMaster();var log=(0,_debug.default)('zashiki:common:rid:omega:get-rid');log('`getRID` is awake');function getRID(_x){return _getRID.apply(this,arguments);}function _getRID(){_getRID=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(_ref){var _ref$pre,_ref$pre2,jid,_ref$state,state,_ref$params,params,_yield$getOmegaFromCa,aid,oid,routeList,resource,_yield$routeList$getO,rid;return _regenerator.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_ref$pre=_ref.pre,_ref$pre2=_ref$pre===void 0?{}:_ref$pre,jid=_ref$pre2.jid,_ref$state=_ref.state,state=_ref$state===void 0?{}:_ref$state,_ref$params=_ref.params,params=_ref$params===void 0?{}:_ref$params;log('getRID');_context.t0=_caches.getOmegaFromCache;_context.next=5;return(0,_maps.mapAlphaOmega)(params);case 5:_context.t1=_context.sent;_context.next=8;return(0,_context.t0)(_context.t1);case 8:_yield$getOmegaFromCa=_context.sent;aid=_yield$getOmegaFromCa.aid;oid=_yield$getOmegaFromCa.oid;routeList=routeListMaster.use(jid);resource={alpha:aid,omega:oid};_context.next=15;return routeList.hasOmega(resource);case 15:if(!_context.sent){_context.next=21;break;}_context.next=18;return routeList.getOmega(resource);case 18:_yield$routeList$getO=_context.sent;rid=_yield$routeList$getO.rid;return _context.abrupt("return",rid);case 21:throw _boom.default.notFound(_exception.NOT_FOUND);case 22:case"end":return _context.stop();}}},_callee);}));return _getRID.apply(this,arguments);}