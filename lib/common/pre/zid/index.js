"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _boom=_interopRequireDefault(require("@hapi/boom"));var _config=_interopRequireDefault(require("../../../config"));var _zashikiTransport=require("@modernpoacher/zashiki-transport");var _exception=require("../../exception");const ZID=_config.default.get('zashiki:zid');const BEARERTOKEN=/[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}/i;const getBearerToken=(value='')=>(value.match(BEARERTOKEN)||[]).shift();var _default={assign:'zid',async method({state={},headers:{authorization}},h){let{zid=getBearerToken(authorization)}=state;try{h.state('zid',zid||(zid=await(0,_zashikiTransport.createZID)()),ZID);return zid;}catch(e){throw _boom.default.badImplementation(_exception.BAD_IMPLEMENTATION,e);}}};exports.default=_default;